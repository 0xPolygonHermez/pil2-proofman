require "std_lookup.pil";
require "std_range_check.pil";

/*
    To audit and generate stats:
    node ../pil2-compiler/src/pil.js ./pil2-components/test/std/special/virtual_tables.pil -I ./pil2-components/lib/std/pil -o ./pil2-components/test/std/special/build/virtual_tables.pilout
    node --max-old-space-size=131072 ../pil2-compiler/tools/audit.js pil2-components/test/std/special/build/virtual_tables.pilout
    node --max-old-space-size=131072 ../pil2-proofman-js/src/main_stats.js -a pil2-components/test/std/special/build/virtual_tables.pilout -o pil2-components/test/std/special/build/virtual_tables.stats
*/

airtemplate Component(const int N, const int t, const int opid) {
    col witness a[t];
    lookup_assumes(opid, a);
}

airtemplate ComponentRC(const int N, const int t, const int opid) {
    col witness a[t];

    range_check(expression: a[0], min: 0, max: 2**8 - 1, predefined: 1);
    range_check(expression: a[0], min: 0, max: 2**16 - 1, predefined: 1);
    range_check(expression: a[0], min: 0, max: 2**6 - 1, predefined: 0);

    lookup_assumes(opid, a);
}

airtemplate Table(const int N, const int t, const int opid) {
    col fixed A[t];
    for (int i = 0; i < N; i++) {
        for (int j = 0; j < t; j++) {
            A[j][i] = i;
        }
    }

    lookup_proves(opid, A);
}

airgroup VirtualTables {
    set_range_check_tables_virtual(); // Enable virtual tables for range checks
    set_max_virtual_bits(15); // Set the maximum bits for virtual tables

    Component(N: 2**5, t: 5, opid: 1) alias Component1;
    virtual Table(N: 2**5, t: 5, opid: 1) alias Table1;

    Component(N: 2**4, t: 3, opid: 2) alias Component2;
    virtual Table(N: 2**4, t: 3, opid: 2) alias Table2;

    Component(N: 2**2, t: 3, opid: 3) alias Component3;
    virtual Table(N: 2**2, t: 3, opid: 3) alias Table3;

    ComponentRC(N: 2**7, t: 2, opid: 4) alias Component4;
    virtual Table(N: 2**7, t: 2, opid: 4) alias Table4;
    
    Component(N: 2**6, t: 6, opid: 5) alias Component5;
    virtual Table(N: 2**6, t: 6, opid: 5) alias Table5;
    
    Component(N: 2**10, t: 2, opid: 6) alias Component6;
    virtual Table(N: 2**10, t: 2, opid: 6) alias Table6;
}